"use client";

import { useState } from "react";

type Run = {
  id: number;
  date: string;
  distance: number;
  note: string;
};

// è¿·ä½ è·‘æ­¥è®°å½•ç³»ç»Ÿ
export default function RunTracker() {
  const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD

  const [date, setDate] = useState(today);
  const [distance, setDistance] = useState("");
  const [note, setNote] = useState("");
  const [runs, setRuns] = useState<Run[]>([]);

  const addRun = () => {
    const trimmedDistance = distance.trim();

    const numDistance = parseFloat(trimmedDistance);

    // ç®€å•æ£€æŸ¥
    if (!trimmedDistance || isNaN(numDistance) || numDistance <= 0) {
      alert("è¯·å¡«å†™æ­£ç¡®çš„è·‘æ­¥è·ç¦»ï¼ˆå¤§äº 0 çš„æ•°å­—ï¼‰");
      return;
    }

    const newRun = {
      id: Date.now(),
      date,
      distance: numDistance,
      note: note.trim(),
    };

    setRuns([...runs, newRun]);

    // æ¸…ç©ºéƒ¨åˆ†è¾“å…¥
    setDistance("");
    setNote("");
  };

  // æ€»é‡Œç¨‹
  const totalDistance = runs.reduce((sum, run) => sum + run.distance, 0);

  return (
    <div
      style={{
        marginTop: 24,
        padding: 20,
        border: "1px solid #ccc",
        borderRadius: 8,
      }}
    >
      <h2>ğŸƒâ€â™€ï¸ è¿·ä½ è·‘æ­¥è®°å½•ç³»ç»Ÿ</h2>

      {/* ç»Ÿè®¡ä¿¡æ¯ */}
      <p style={{ marginTop: 8 }}>
        å·²è®°å½•æ¬¡æ•°ï¼š<strong>{runs.length}</strong> æ¬¡ï¼Œ
        ç´¯è®¡é‡Œç¨‹ï¼š<strong>{totalDistance.toFixed(2)}</strong> km
      </p>

      {/* æ—¥æœŸ */}
      <div style={{ marginTop: 12 }}>
        <label style={{ marginRight: 8 }}>æ—¥æœŸï¼š</label>
        <input
          type="date"
          value={date}
          onChange={(e) => setDate(e.target.value)}
        />
      </div>

      {/* è·ç¦» */}
      <div style={{ marginTop: 12 }}>
        <label style={{ marginRight: 8 }}>è·ç¦»ï¼ˆkmï¼‰ï¼š</label>
        <input
          type="number"
          value={distance}
          onChange={(e) => setDistance(e.target.value)}
          placeholder="ä¾‹å¦‚ 5 æˆ– 10.5"
          step="0.1"
        />
      </div>

      {/* å¤‡æ³¨ */}
      <div style={{ marginTop: 12 }}>
        <label style={{ display: "block", marginBottom: 4 }}>å¤‡æ³¨ï¼š</label>
        <textarea
          value={note}
          onChange={(e) => setNote(e.target.value)}
          rows={2}
          placeholder="æ¯”å¦‚ï¼šé…é€Ÿ 6'ï¼ŒçŠ¶æ€å¾ˆå¥½ã€å¤©æ°”å‡‰çˆ½ï½"
          style={{ width: "100%" }}
        />
      </div>

      {/* æ·»åŠ æŒ‰é’® */}
      <button style={{ marginTop: 12 }} onClick={addRun}>
        æ·»åŠ è®°å½•
      </button>

      {/* è®°å½•åˆ—è¡¨ */}
      <ul style={{ marginTop: 20 }}>
        {runs.map((run) => (
          <li
            key={run.id}
            style={{
              marginBottom: 10,
              padding: 10,
              border: "1px solid #eee",
              borderRadius: 6,
            }}
          >
            <div>
              ğŸ“… {run.date} â€”â€” ğŸƒâ€â™€ï¸ {run.distance} km
            </div>
            {run.note && (
              <div style={{ marginTop: 4, color: "#555" }}>ğŸ’¬ {run.note}</div>
            )}
          </li>
        ))}
      </ul>
    </div>
  );
}
